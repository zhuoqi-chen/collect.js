{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./node_modules/flyio/index.js","webpack:///./node_modules/get-selector/index.js","webpack:///./node_modules/flyio/dist/npm/fly.js","webpack:///./node_modules/is-el/index.js","webpack:///./src/index.js"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","fly","isEl","el","t","parentNode","id","unshift","ownerDocument","documentElement","body","tagName","toLowerCase","previousElementSibling","join","_typeof","Symbol","iterator","obj","constructor","type","ob","toString","slice","isObject","real","this","isFormData","val","FormData","trim","str","replace","encode","encodeURIComponent","formatParams","data","first","that","_encode","sub","path","forEach","e","key","merge","b","_createClass","defineProperties","target","props","length","descriptor","writable","Constructor","protoProps","staticProps","utils","isBrowser","document","Fly","engine","wrap","interceptor","completer","lock","Promise","resolve","unlock","instance","TypeError","_classCallCheck","XMLHttpRequest","default","interceptors","response","use","handler","onerror","request","irq","config","method","baseURL","headers","timeout","parseJson","withCredentials","url","options","_this","contentType","contentTypeLowerCase","requestInterceptor","responseInterceptor","requestInterceptorHandler","promise","reject","isPromise","then","catch","enqueueIfLocked","callback","toUpperCase","ret","baseUrl","location","href","indexOf","isAbsolute","arr","pathname","split","pop","protocol","host","substr","createElement","responseType","isGet","open","_contentType","JSON","stringify","k","setRequestHeader","onresult","undefined","Err","msg","status","message","onload","responseText","getResponseHeader","parse","items","getAllResponseHeaders","statusText","_response","ontimeout","_options","setTimeout","send","makeRequest","err","promises","all","apply","option","nodeType","Node","ELEMENT_NODE","style","WEIGHT","collect","Collect","userInfo","_init","_afterEnter","_addEventListener","_this2","unload","onunload","_beforeLeave","oriXOpen","asncFlag","user","password","_dispatch","onclick","nodeName","attributes","DOMPath","get_selector__WEBPACK_IMPORTED_MODULE_0___default","DOMRect","getBoundingClientRect","_preHandleBehaviors","console","log","behaviors","startTime","Date","now","_saveData","_getData","_resetData","reduce","accumulator","currentValue","event","timestamp","weight","requestUrl","push","_clientId","clientId","_userId","userId","time","stayTime","localStorage","setItem","referrer","encodeReferrer","getItem","error","isClose","_post","removeItem","flyio__WEBPACK_IMPORTED_MODULE_1___default","post","arguments","_ref"],"mappings":"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","file":"collect.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","//For browser entry\nvar Fly= require(\"./dist/npm/fly\")\nvar fly= new Fly;\nmodule.exports = fly;\n","'use strict';\n\nvar isEl = require('is-el');\n\n/**\n * @module getSelector\n * @description Generates a unique CSS selector that will match only the passed element.\n *\n * @param {element} element - target element\n * @return {(string|boolean)} CSS selector that will return only the passed element, false if element is not valid\n */\nmodule.exports = function (el) {\n\t// Iterator for nth-child loop\n\tvar i = null;\n\n\t// Query parts collection\n\tvar s = [];\n\n\t// Current element's tag name\n\tvar t = null;\n\n\t// Not a valid DOM element\n\tif (!isEl(el)) {\n\t\treturn false;\n\t}\n\n\t// Iterate through the element's ancestors\n\twhile (el.parentNode) {\n\t\t// If element has ID, we're done -\n\t\t// build selector from all previous parts\n\t\tif (el.id) {\n\t\t\ts.unshift('#' + el.id);\n\t\t\tbreak;\n\t\t} else {\n\t\t\t// Reached the body or html tag -\n\t\t\t// add the tag to the parts collection\n\t\t\tif (el === el.ownerDocument.documentElement ||\n\t\t\t\tel === el.ownerDocument.body) {\n\t\t\t\ts.unshift(el.tagName.toLowerCase());\n\t\t\t// Get the element's position amongst its\n\t\t\t// siblings to build an \"nth-child\" selector\n\t\t\t} else {\n\t\t\t\t// Grab tagName before iterating through\n\t\t\t\t// siblings in case there is mixed ancestry\n\t\t\t\tt = el.tagName.toLowerCase();\n\t\t\t\tfor (i = 1; el.previousElementSibling; i++) {\n\t\t\t\t\tel = el.previousElementSibling;\n\t\t\t\t}\n\t\t\t\ts.unshift(t + ':nth-child(' + i + ')');\n\t\t\t}\n\t\t\t// Repeat for parent\n\t\t\tel = el.parentNode;\n\t\t}\n\t}\n\n\t// Return all parts, joined\n\treturn s.join(' > ');\n};\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n    /******/\n    return __webpack_require__(__webpack_require__.s = 2);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nmodule.exports = {\n    type: function type(ob) {\n        return Object.prototype.toString.call(ob).slice(8, -1).toLowerCase();\n    },\n    isObject: function isObject(ob, real) {\n        if (real) {\n            return this.type(ob) === \"object\";\n        } else {\n            return ob && (typeof ob === 'undefined' ? 'undefined' : _typeof(ob)) === 'object';\n        }\n    },\n    isFormData: function isFormData(val) {\n        return typeof FormData !== 'undefined' && val instanceof FormData;\n    },\n    trim: function trim(str) {\n        return str.replace(/(^\\s*)|(\\s*$)/g, '');\n    },\n    encode: function encode(val) {\n        return encodeURIComponent(val).replace(/%40/gi, '@').replace(/%3A/gi, ':').replace(/%24/g, '$').replace(/%2C/gi, ',').replace(/%20/g, '+').replace(/%5B/gi, '[').replace(/%5D/gi, ']');\n    },\n    formatParams: function formatParams(data) {\n        var str = \"\";\n        var first = true;\n        var that = this;\n        if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) != \"object\") {\n            return data;\n        }\n        function _encode(sub, path) {\n            var encode = that.encode;\n            var type = that.type(sub);\n            if (type == \"array\") {\n                sub.forEach(function (e, i) {\n                    _encode(e, path + \"%5B%5D\");\n                });\n            } else if (type == \"object\") {\n                for (var key in sub) {\n                    if (path) {\n                        _encode(sub[key], path + \"%5B\" + encode(key) + \"%5D\");\n                    } else {\n                        _encode(sub[key], encode(key));\n                    }\n                }\n            } else {\n                if (!first) {\n                    str += \"&\";\n                }\n                first = false;\n                str += path + \"=\" + encode(sub);\n            }\n        }\n\n        _encode(data, \"\");\n        return str;\n    },\n\n    // Do not overwrite existing attributes\n    merge: function merge(a, b) {\n        for (var key in b) {\n            if (!a.hasOwnProperty(key)) {\n                a[key] = b[key];\n            } else if (this.isObject(b[key], 1) && this.isObject(a[key], 1)) {\n                this.merge(a[key], b[key]);\n            }\n        }\n        return a;\n    }\n};\n\n/***/ }),\n/* 1 */,\n    /* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\nfunction KEEP(_,cb){cb();}\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = __webpack_require__(0);\nvar isBrowser = typeof document !== \"undefined\";\n\nvar Fly = function () {\n    function Fly(engine) {\n        _classCallCheck(this, Fly);\n\n        this.engine = engine || XMLHttpRequest;\n\n        this.default = this; //For typeScript\n\n        /**\n         * Add  lock/unlock API for interceptor.\n         *\n         * Once an request/response interceptor is locked, the incoming request/response\n         * will be added to a queue before they enter the interceptor, they will not be\n         * continued  until the interceptor is unlocked.\n         *\n         * @param [interceptor] either is interceptors.request or interceptors.response\n         */\n        function wrap(interceptor) {\n            var completer;\n            utils.merge(interceptor, {\n                lock: function lock() {\n                    if (!completer) {\n                        interceptor.p = new Promise(function (resolve) {\n                            completer = resolve;\n                        });\n                    }\n                },\n                unlock: function unlock() {\n                    if (completer) {\n                        completer();\n                        interceptor.p = completer = null;\n                    }\n                }\n            });\n        }\n\n        var interceptors = this.interceptors = {\n            response: {\n                use: function use(handler, onerror) {\n                    this.handler = handler;\n                    this.onerror = onerror;\n                }\n            },\n            request: {\n                use: function use(handler) {\n                    this.handler = handler;\n                }\n            }\n        };\n\n        var irq = interceptors.request;\n        var irp = interceptors.response;\n        wrap(irp);\n        wrap(irq);\n\n        this.config = {\n            method: \"GET\",\n            baseURL: \"\",\n            headers: {},\n            timeout: 0,\n            parseJson: true, // Convert response data to JSON object automatically.\n            withCredentials: false\n        };\n    }\n\n    _createClass(Fly, [{\n        key: \"request\",\n        value: function request(url, data, options) {\n            var _this = this;\n\n            var engine = new this.engine();\n            var contentType = \"Content-Type\";\n            var contentTypeLowerCase = contentType.toLowerCase();\n            var interceptors = this.interceptors;\n            var requestInterceptor = interceptors.request;\n            var responseInterceptor = interceptors.response;\n            var requestInterceptorHandler = requestInterceptor.handler;\n            var promise = new Promise(function (resolve, reject) {\n                if (utils.isObject(url)) {\n                    options = url;\n                    url = options.url;\n                }\n                options = options || {};\n                options.headers = options.headers || {};\n\n                function isPromise(p) {\n                    // some  polyfill implementation of Promise may be not standard,\n                    // so, we test by duck-typing\n                    return p && p.then && p.catch;\n                }\n\n                /**\n                 * If the request/response interceptor has been locked，\n                 * the new request/response will enter a queue. otherwise, it will be performed directly.\n                 * @param [promise] if the promise exist, means the interceptor is  locked.\n                 * @param [callback]\n                 */\n                function enqueueIfLocked(promise, callback) {\n                    if (promise) {\n                        promise.then(function () {\n                            callback();\n                        });\n                    } else {\n                        callback();\n                    }\n                }\n\n                // make the http request\n                function makeRequest(options) {\n                    data = options.body;\n                    // Normalize the request url\n                    url = utils.trim(options.url);\n                    var baseUrl = utils.trim(options.baseURL || \"\");\n                    if (!url && isBrowser && !baseUrl) url = location.href;\n                    if (url.indexOf(\"http\") !== 0) {\n                        var isAbsolute = url[0] === \"/\";\n                        if (!baseUrl && isBrowser) {\n                            var arr = location.pathname.split(\"/\");\n                            arr.pop();\n                            baseUrl = location.protocol + \"//\" + location.host + (isAbsolute ? \"\" : arr.join(\"/\"));\n                        }\n                        if (baseUrl[baseUrl.length - 1] !== \"/\") {\n                            baseUrl += \"/\";\n                        }\n                        url = baseUrl + (isAbsolute ? url.substr(1) : url);\n                        if (isBrowser) {\n\n                            // Normalize the url which contains the \"..\" or \".\", such as\n                            // \"http://xx.com/aa/bb/../../xx\" to \"http://xx.com/xx\" .\n                            var t = document.createElement(\"a\");\n                            t.href = url;\n                            url = t.href;\n                        }\n                    }\n\n                    var responseType = utils.trim(options.responseType || \"\");\n                    engine.withCredentials = !!options.withCredentials;\n                    var isGet = options.method === \"GET\";\n                    if (isGet) {\n                        if (data) {\n                            if (utils.type(data) !== \"string\") {\n                                data = utils.formatParams(data);\n                            }\n                            url += (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + data;\n                        }\n                    }\n                    engine.open(options.method, url);\n\n                    // try catch for ie >=9\n                    try {\n                        engine.timeout = options.timeout || 0;\n                        if (responseType !== \"stream\") {\n                            engine.responseType = responseType;\n                        }\n                    } catch (e) {\n                    }\n\n                    if (!isGet) {\n                        // default content type\n                        var _contentType = \"application/x-www-form-urlencoded\";\n                        // If the request data is json object, transforming it  to json string,\n                        // and set request content-type to \"json\". In browser,  the data will\n                        // be sent as RequestBody instead of FormData\n                        if (utils.trim((options.headers[contentType] || \"\").toLowerCase()) === _contentType) {\n                            data = utils.formatParams(data);\n                        } else if (!utils.isFormData(data) && [\"object\", \"array\"].indexOf(utils.type(data)) !== -1) {\n                            _contentType = 'application/json;charset=utf-8';\n                            data = JSON.stringify(data);\n                        }\n                        options.headers[contentType] = _contentType;\n                    }\n\n                    for (var k in options.headers) {\n                        if (k === contentType && (utils.isFormData(data) || !data || isGet)) {\n                            // Delete the content-type, Let the browser set it\n                            delete options.headers[k];\n                        } else {\n                            try {\n                                // In browser environment, some header fields are readonly,\n                                // write will cause the exception .\n                                engine.setRequestHeader(k, options.headers[k]);\n                            } catch (e) {\n                            }\n                        }\n                    }\n\n                    function onresult(handler, data, type) {\n                        enqueueIfLocked(responseInterceptor.p, function () {\n                            if (handler) {\n                                //如果失败，添加请求信息\n                                if (type) {\n                                    data.request = options;\n                                }\n                                var ret = handler.call(responseInterceptor, data, Promise);\n                                data = ret === undefined ? data : ret;\n                            }\n                            if (!isPromise(data)) {\n                                data = Promise[type === 0 ? \"resolve\" : \"reject\"](data);\n                            }\n                            data.then(function (d) {\n                                resolve(d);\n                            }).catch(function (e) {\n                                reject(e);\n                            });\n                        });\n                    }\n\n                    function onerror(e) {\n                        e.engine = engine;\n                        onresult(responseInterceptor.onerror, e, -1);\n                    }\n\n                    function Err(msg, status) {\n                        this.message = msg;\n                        this.status = status;\n                    }\n\n                    engine.onload = function () {\n                        // The xhr of IE9 has not response filed\n                        var response = engine.response || engine.responseText;\n                        if (options.parseJson && (engine.getResponseHeader(contentType) || \"\").indexOf(\"json\") !== -1\n                        // Some third engine implementation may transform the response text to json object automatically,\n                        // so we should test the type of response before transforming it\n                        && !utils.isObject(response)) {\n                            response = JSON.parse(response);\n                        }\n                        var headers = {};\n                        var items = (engine.getAllResponseHeaders() || \"\").split(\"\\r\\n\");\n                        items.pop();\n                        items.forEach(function (e) {\n                            var key = e.split(\":\")[0];\n                            headers[key] = engine.getResponseHeader(key);\n                        });\n                        var status = engine.status;\n                        var statusText = engine.statusText;\n                        var data = {data: response, headers: headers, status: status, statusText: statusText};\n                        // The _response filed of engine is set in  adapter which be called in engine-wrapper.js\n                        utils.merge(data, engine._response);\n                        if (status >= 200 && status < 300 || status === 304) {\n                            data.engine = engine;\n                            data.request = options;\n                            onresult(responseInterceptor.handler, data, 0);\n                        } else {\n                            var e = new Err(statusText, status);\n                            e.response = data;\n                            onerror(e);\n                        }\n                    };\n\n                    engine.onerror = function (e) {\n                        onerror(new Err(e.msg || \"Network Error\", 0));\n                    };\n\n                    engine.ontimeout = function () {\n                        onerror(new Err(\"timeout [ \" + engine.timeout + \"ms ]\", 1));\n                    };\n                    engine._options = options;\n                    setTimeout(function () {\n                        engine.send(isGet ? null : data);\n                    }, 0);\n                }\n\n                enqueueIfLocked(requestInterceptor.p, function () {\n                    utils.merge(options, _this.config);\n                    var headers = options.headers;\n                    headers[contentType] = headers[contentType] || headers[contentTypeLowerCase] || \"\";\n                    delete headers[contentTypeLowerCase];\n                    options.body = data || options.body;\n                    url = utils.trim(url || \"\");\n                    options.method = options.method.toUpperCase();\n                    options.url = url;\n                    var ret = options;\n                    if (requestInterceptorHandler) {\n                        ret = requestInterceptorHandler.call(requestInterceptor, options, Promise) || options;\n                    }\n                    if (!isPromise(ret)) {\n                        ret = Promise.resolve(ret);\n                    }\n                    ret.then(function (d) {\n                        //if options continue\n                        if (d === options) {\n                            makeRequest(d);\n                        } else {\n                            resolve(d);\n                        }\n                    }, function (err) {\n                        reject(err);\n                    });\n                });\n            });\n            promise.engine = engine;\n            return promise;\n        }\n    }, {\n        key: \"all\",\n        value: function all(promises) {\n            return Promise.all(promises);\n        }\n    }, {\n        key: \"spread\",\n        value: function spread(callback) {\n            return function (arr) {\n                return callback.apply(null, arr);\n            };\n        }\n    }, {\n        key: \"lock\",\n        value: function lock() {\n            this.interceptors.request.lock();\n        }\n    }, {\n        key: \"unlock\",\n        value: function unlock() {\n            this.interceptors.request.unlock();\n        }\n    }]);\n\n    return Fly;\n}();\n\n//For typeScript\n\n\n        Fly.default = Fly;\n\n[\"get\", \"post\", \"put\", \"patch\", \"head\", \"delete\"].forEach(function (e) {\n    Fly.prototype[e] = function (url, data, option) {\n        return this.request(url, data, utils.merge({ method: e }, option));\n    };\n});\n// Learn more about keep-loader: https://github.com/wendux/keep-loader\n;\nmodule.exports = Fly;\n\n/***/ })\n/******/ ]);\n});","'use strict';\n\n/**\n * @module\n * isEl\n *\n * @description\n * Determine if passed value is a valid element\n *\n * @param {element} element - Value to evaluate\n * @return {boolean} - Return true if value is an element, otherwise false\n */\nmodule.exports = function (value) {\n\treturn (value !== null)\n\t\t&& (typeof value === 'object')\n\t\t&& (value.nodeType === Node.ELEMENT_NODE)\n\t\t&& (typeof value.style === 'object')\n\t\t&& (typeof value.ownerDocument === 'object');\n};\n","import getSelector from \"get-selector\";\nimport fly from \"flyio\";\nconst SPACE_TIME = 1000;\nconst IS_DEBUGGER = true;\nconst INTERVAL_FRO_CLICK_TO_HTTP = 10;\nconst API_URL =\n  \"https://easy-mock.com/mock/5b02697255348c1c9545d9cc/api/channel\";\nconst WEIGHT = {\n  HIGH: 3,\n  MEDIUM: 2,\n  LOW: 1\n};\nclass Collect {\n  constructor() {\n    this.userInfo = {};\n    this._init();\n  }\n  _init() {\n    // const _this = this;\n    // // 支持History API\n    // if (window.history && history.pushState) {\n    //   const replaceState = history.replaceState;\n    //   const pushState = history.pushState;\n    //   history.replaceState = function() {\n    //     _this.referrer = window.location.href;\n    //     _this._beforeLeave();\n    //     replaceState.apply(history, arguments);\n    //     _this._afterEnter();\n    //   };\n    //   history.pushState = function() {\n    //     _this.referrer = window.location.href;\n    //     _this._beforeLeave();\n    //     pushState.apply(history, arguments);\n    //     _this._afterEnter();\n    //   };\n    // }\n    this._afterEnter();\n    this._addEventListener();\n  }\n  /**\n   * 注册事件\n   */\n  _addEventListener() {\n    const _this = this;\n    //关闭浏览器之前\n    const unload = window.onunload || (() => {});\n    window.onunload = () => {\n      this._beforeLeave();\n      unload();\n    };\n    const oriXOpen = XMLHttpRequest.prototype.open;\n    XMLHttpRequest.prototype.open = function(\n      method,\n      url,\n      asncFlag,\n      user,\n      password\n    ) {\n      _this._dispatch(\"http\", { url });\n      oriXOpen.call(this, method, url, asncFlag, user, password);\n    };\n    //注册全局点击事件\n    document.body.onclick = e => {\n      const { target } = e;\n      const { nodeName, attributes } = target;\n      this._dispatch(\"click\", {\n        DOMPath: getSelector(target),\n        DOMRect: target.getBoundingClientRect()\n      });\n      if (\n        nodeName.toLowerCase() === \"a\" &&\n        attributes &&\n        attributes.target &&\n        attributes.target.value.toLowerCase() === \"_blank\"\n      ) {\n        this._beforeLeave();\n      }\n      this._preHandleBehaviors();\n      IS_DEBUGGER && console.log(this.behaviors);\n    };\n  }\n  _resetData() {\n    IS_DEBUGGER && console.log(\"_resetData\");\n    this.startTime = Date.now();\n    this.behaviors = [];\n  }\n  /**\n   * 页面关闭之前\n   * 存储下用户操作信息\n   */\n  _beforeLeave() {\n    IS_DEBUGGER && console.log(\"_beforeLeave\");\n    this._saveData();\n  }\n  /**\n   * 页面进入之后\n   * 判断localStorage是否有当前的页面referrer页面的数据\n   * 有并在一定时间内,就将referrer页的用户行为收集\n   */\n  _afterEnter() {\n    IS_DEBUGGER && console.log(\"_afterEnter\");\n    this._getData();\n    this._resetData();\n  }\n  _preHandleBehaviors() {\n    const behaviors = [];\n    this.behaviors.reduce((accumulator, currentValue) => {\n      if (\n        accumulator &&\n        accumulator.event === \"http\" &&\n        currentValue.event === \"click\" &&\n        currentValue.timestamp - accumulator.timestamp <\n          INTERVAL_FRO_CLICK_TO_HTTP &&\n        currentValue.weight < WEIGHT.MEDIUM\n      ) {\n        currentValue.weight = WEIGHT.MEDIUM;\n        currentValue.data.requestUrl = accumulator.data.url;\n      }\n      if (currentValue.event === \"click\") {\n        behaviors.push(currentValue);\n      }\n      return currentValue;\n    }, null);\n    return behaviors;\n  }\n  /**\n   * 存储本页收集的数据\n   */\n  _saveData() {\n    IS_DEBUGGER && console.log(\"_saveData\");\n    const href = window.location.href;\n    const { clientId = null, userId = null } = this;\n    const behaviors = this._preHandleBehaviors();\n    if (!behaviors.length || !clientId) return;\n    const time = Date.now();\n    const stayTime = time - this.startTime;\n    const data = { time, stayTime, userId, behaviors };\n    window.localStorage.setItem(encodeURIComponent(href), JSON.stringify(data));\n  }\n  /**\n   * 获取上页过来的数据,符合条件就上传\n   */\n  _getData() {\n    IS_DEBUGGER && console.log(\"_getData\");\n    const referrer = document.referrer;\n    if (!referrer) return;\n    const encodeReferrer = encodeURIComponent(referrer);\n    let data = null;\n    try {\n      data = JSON.parse(window.localStorage.getItem(encodeReferrer));\n    } catch (error) {\n      return;\n      console.error(error);\n    }\n    if (!data) return;\n    //上次采集的数据和这次页面的打开的时间的一定时间内\n    const isClose = Date.now() - data.time < SPACE_TIME;\n    const target = window.location.href;\n    if (isClose) {\n      data.referrer = referrer;\n      data.target = target;\n      this._post(data);\n      window.localStorage.removeItem(encodeReferrer);\n    }\n  }\n  /**\n   * post数据\n   */\n  _post(data) {\n    IS_DEBUGGER && console.log(\"_post\", data);\n    return fly.post(API_URL, data);\n  }\n  /**\n   * 触发收集事件\n   * @param {String} event\n   * @param {Object} data\n   */\n  _dispatch(event, data, weight = 1) {\n    this.behaviors.push({\n      event,\n      weight: WEIGHT.LOW,\n      timestamp: Date.now(),\n      data\n    });\n  }\n  config({ clientId, userId }) {\n    this.clientId = clientId;\n    this.userId = userId;\n  }\n}\nexport const collect = new Collect();\n"],"sourceRoot":""}